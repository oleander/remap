<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="remap-remaphttpsgithubcomoleanderremapactionsworkflowsmainymlbadgesvgbranchdevelopmenthttpsgithubcomoleanderremapactionsworkflowsmainyml-gemhttpsimgshieldsiogemvremaphttpsrubygemsorggemsremap-maintainabilityhttpsapicodeclimatecomv1badges0c09721ad5a3b646a6d3maintainabilityhttpscodeclimatecomgithuboleanderremapmaintainability-test-coveragehttpsapicodeclimatecomv1badges0c09721ad5a3b646a6d3testcoveragehttpscodeclimatecomgithuboleanderremaptestcoverage">Re:map <a href="https://github.com/oleander/remap/actions/workflows/main.yml"><img src="https://github.com/oleander/remap/actions/workflows/main.yml/badge.svg?branch=development" alt="remap" /></a> <a href="https://rubygems.org/gems/remap"><img src="https://img.shields.io/gem/v/remap" alt="Gem" /></a> <a href="https://codeclimate.com/github/oleander/remap/maintainability"><img src="https://api.codeclimate.com/v1/badges/0c09721ad5a3b646a6d3/maintainability" alt="Maintainability" /></a> <a href="https://codeclimate.com/github/oleander/remap/test_coverage"><img src="https://api.codeclimate.com/v1/badges/0c09721ad5a3b646a6d3/test_coverage" alt="Test Coverage" /></a></h1>

<p><code>Re:map</code>; an expressive and feature-rich data transformer written in Ruby 3.
It gives the developer the expressive power of JSONPath, without the hassle of using strings. Its compiler is written on top of an immutable, primitive data structure utilizing ruby’s refinements &amp; pattern matching capabilities – making it blazingly fast</p>

<ul>
  <li>Overview
    <ul>
      <li><a href="http://oleander.io/remap">API Documentation</a></li>
      <li><a href="#quick-start">Quick start</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#introduction">Introduction</a>
        <ul>
          <li><a href="#selectors">Selectors</a></li>
          <li><a href="#callbacks">Callbacks</a></li>
          <li><a href="#fixed--semi-fixed-values">Fixed &amp; semi-fixed values</a></li>
          <li><a href="#type-casting">Type casting</a></li>
          <li><a href="#operators">Operators</a></li>
          <li><a href="#error-handling">Error handling</a></li>
          <li><a href="#constructors">Constructors</a></li>
          <li><a href="#schemas--rules">Schemas &amp; rules</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="quick-start">Quick start</h2>

<p>``` ruby
require “remap”</p>

<p>class Mapper &lt; Remap::Base
  option :date # &lt;= Custom required value</p>

<p>define do
    # Fixed values
    set :description, to: value(“This is a description”)</p>

<pre class="code ruby"><code class="ruby"><span style="color:#777"># Semi-dynamic values</span>
set <span style="color:#A60">:date</span>, <span style="color:#606">to</span>: option(<span style="color:#A60">:date</span>)

<span style="color:#777"># Required rules</span>
get <span style="color:#A60">:friends</span> <span style="color:#080;font-weight:bold">do</span>
  each <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#777"># Post processors</span>
    map(<span style="color:#A60">:name</span>, <span style="color:#606">to</span>: <span style="color:#A60">:id</span>).then <span style="color:#080;font-weight:bold">do</span> |<span style="color:#606">value</span>:|
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>value.upcase<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#777"># Field conditions</span>
    get?(<span style="color:#A60">:age</span>).if <span style="color:#080;font-weight:bold">do</span> |age|
      (<span style="color:#00D">30</span>..<span style="color:#00D">50</span>).cover?(age)
    <span style="color:#080;font-weight:bold">end</span>

    <span style="color:#777"># Map to a finite set of values</span>
    get <span style="color:#A60">:phones</span> <span style="color:#080;font-weight:bold">do</span>
      each <span style="color:#080;font-weight:bold">do</span>
        map.enum <span style="color:#080;font-weight:bold">do</span>
          from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iPhone</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">to</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iOS</span><span style="color:#710">&quot;</span></span>
          value <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">iOS</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Android</span><span style="color:#710">&quot;</span></span>

          otherwise <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unknown</span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">end</span>
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># Composable mappers</span>
<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Linux</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    get <span style="color:#A60">:kernel</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Windows</span> &lt; <span style="color:#036;font-weight:bold">Remap</span>::<span style="color:#036;font-weight:bold">Base</span>
  define <span style="color:#080;font-weight:bold">do</span>
    get <span style="color:#A60">:price</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># Embed mappers</span>
to <span style="color:#A60">:os</span> <span style="color:#080;font-weight:bold">do</span>
  map <span style="color:#A60">:computer</span>, <span style="color:#A60">:operating_system</span> <span style="color:#080;font-weight:bold">do</span>
    embed <span style="color:#036;font-weight:bold">Linux</span> | <span style="color:#036;font-weight:bold">Windows</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># Wrapping values in arrays</span>
to <span style="color:#A60">:houses</span> <span style="color:#080;font-weight:bold">do</span>
  wrap <span style="color:#A60">:array</span> <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:house</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># Nested paths ($.cars[*].model)</span>
map <span style="color:#A60">:cars</span>, all, <span style="color:#A60">:model</span>, <span style="color:#606">to</span>: <span style="color:#A60">:cars</span>

<span style="color:#777"># Or using the #each iterator</span>
map <span style="color:#A60">:cars</span> <span style="color:#080;font-weight:bold">do</span>
  each <span style="color:#080;font-weight:bold">do</span>
    map <span style="color:#A60">:model</span>, <span style="color:#606">to</span>: <span style="color:#A60">:cars</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>   <span style="color:#080;font-weight:bold">end</span> <span style="color:#080;font-weight:bold">end</span> <span style="background-color:hsla(120,100%,50%,0.06)"><span style="color:#161">`</span><span style="color:#161">`</span></span><span style="background-color:hsla(120,100%,50%,0.06)"><span style="color:#161">`</span><span style="color:#2B2">
</span></span></code></pre>

<p>Input hash to be mapped</p>

<p><code>ruby
input = {
  house: "100kvm",
  friends: [
    {
      name: "Lisa",
      age: 20,
      phones: ["iPhone"]
    }, {
      name: "Jane",
      age: 40,
      phones: ["Samsung"]
    }
  ],
  computer: {
    operating_system: {
      kernel: :latest
    }
  },
  cars: [
    {
      owners: [
        {
          name: "John"
        }
      ]
    }
  ]
}
</code></p>

<p>The expected mapped output</p>

<p><code>ruby
output = {
  friends: [
    {
      id: "LISA!",
      phones: ["iOS"]
    }, {
      age: 40,
      id: "JANE!",
      phones: ["Unknown"]
    }
  ],
  description: "This is a description",
  cars: [{ owners: ["John"] }],
  houses: ["100kvm"],
  date: Date.today,
  os: {
    kernel: :latest
  }
}
</code></p>

<p>Invoking the mapper with input and the <code>date</code> option</p>

<p><code>ruby
Mapper.call(input, date: Date.today) # =&gt; output
</code></p>

<h2 id="installation">Installation</h2>

<p>Add <code>remap</code> to your <code>Gemfile</code></p>

<p>``` ruby
# Use Github as source
source “https://rubygems.pkg.github.com/oleander” do
  gem “remap”
end</p>

<h1 id="or-rubygems">Or Rubygems</h1>
<p>gem “remap”
```</p>

<p>Then run <code>bundle install</code></p>

<h2 id="introduction">Introduction</h2>

<p>To create a mapper, inherit from <code>Remap::Base</code> and define your rules using <code>define</code>.</p>

<p>``` ruby
class Mapper &lt; Remap::Base
  define do
    # rules goes here
  end
end</p>

<p>Mapper.call(input)
```</p>

<p>Or use <code>define</code> method directly on the Remap module</p>

<p>``` ruby
mapper = Remap.define do
  # rules goes here
end</p>

<p>mapper.call(input)
```</p>

<p>The easiest way to get started is using <code>map</code>.
<code>map</code> transform a value from one path to another.</p>

<p><code>ruby
class Mapper &lt; Remap::Base
  define do
    map :name, to: :nickname
  end
end
</code></p>

<p>To invoke the mapper, call <code>Mapper.call</code> with any input, i.e</p>

<p><code>ruby
Mapper.call({ name: "John" }) # =&gt; { nickname: "John" }
</code></p>

<p>If the input data doesn’t match the defined rule, an exception
will be thrown explaining what went wrong and where.
To prevent this, you can pass a block to <code>.call</code>.
The mapper will yield failures to the block instead of raising an error.</p>

<p><code>ruby
Mapper.call({ something: "value" }) do |failure|
  # ...
end
</code></p>

<p>Use <code>map?</code>, <code>to?</code> and <code>get?</code> to map partial data structures.</p>

<p><code>ruby
class Mapper &lt; Remap::Base
  define do
    map? :key1
    map? :key2
  end
end
</code></p>

<p>If one of the two rules succeeds, the mapper returns a value.</p>

<p><code>ruby
Mapper.call({ key1: "value1" }) # ="value1"
Mapper.call({ key2: "value2" }) # ="value2"
</code></p>

<p>If none of the rules succeeds, the mapper invokes the error block.</p>

<p><code>ruby
Mapper.call({ nope: "value" }) do |failure|
  # ...
end
</code></p>

<p>Rules can be expressed in a variety of ways to best fit the
problem at hand.</p>

<p>The following rules yields the same output</p>

<p>``` ruby
# Flat map
map :person, :name, to: :first_name</p>

<h1 id="flat-to">Flat to</h1>
<p>to :first_name, map: [:person, :name]</p>

<h1 id="nested-map">Nested map</h1>
<p>map :person do
  map :name do
    to :first_name
  end
end</p>

<h1 id="nested-to">Nested to</h1>
<p>to :first_name do
  map :person do
    map :name
  end
end
```</p>

<p>To select a value <em>and</em> its path, use <code>get</code>, or <code>get?</code>.</p>

<p>``` ruby
class Mapper &lt; Remap::Base
  define do
    get :person
  end
end</p>

<p>Mapper.call({ person: “John” }) # =&gt; { person: “John” }
```</p>

<p>Use <code>each</code> when iterating over arrays and hashes.</p>

<p>``` ruby
class Mapper &lt; Remap::Base
  define do
    map :people do
      each do
        map :name
      end
    end
  end
end</p>

<p>Mapper.call({ people: [{ name: “John” }, { name: “Jane” }] }) # =&gt; [“John”, “Jane”]
```</p>

<h3 id="selectors">Selectors</h3>

<p>Use the <code>all</code> selector as part of the path instead of <code>each</code>.</p>

<blockquote>
  <p><code>all</code> is similar to JSONPath’s <code>[*]</code> selector</p>
</blockquote>

<p><code>ruby
class Mapper &lt; Remap::Base
  define do
    map :people, all, :name
  end
end
</code></p>

<p><code>first</code> selects the first element in an array and <code>last</code> the last element.</p>

<blockquote>
  <p><code>first</code> &amp; <code>last</code> is similar to JSONPath’s <code>[0]</code> <code>[-1]</code> selectors</p>
</blockquote>

<p>``` ruby
class Mapper &lt; Remap::Base
  define do
    map :people do
      map first, :name, to: :name
    end
  end
end</p>

<p>Mapper.call({ people: [{ name: “John” }] }) # =&gt; { name: “John” }
```</p>

<h3 id="callbacks">Callbacks</h3>

<p>Selected values can easily be processed before being returned using call-backs.</p>

<blockquote>
  <p>See <code>Remap::Rule::Map</code> for more information</p>
</blockquote>

<p>``` ruby
class Mapper &lt; Remap::Base
  using Remap::Extensions::Hash</p>

<p>define do
    map :people, all do
      # Pass a proc
      map(:name).then(&amp;:upcase)</p>

<pre class="code ruby"><code class="ruby">  <span style="color:#777"># Or pass a block</span>
  map(<span style="color:#A60">:name</span>).then <span style="color:#080;font-weight:bold">do</span> |<span style="color:#606">value</span>:|
    value.upcase
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#777"># Manually skip a mapping</span>
  map(<span style="color:#A60">:name</span>).then <span style="color:#080;font-weight:bold">do</span> |&amp;error|
    error[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">skip</span><span style="color:#710">&quot;</span></span>]
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#777"># Add conditions</span>
  map?(<span style="color:#A60">:name</span>).if <span style="color:#080;font-weight:bold">do</span> |<span style="color:#606">value</span>:|
    value.include?(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span>)
  <span style="color:#080;font-weight:bold">end</span>

  map?(<span style="color:#A60">:name</span>).if_not <span style="color:#080;font-weight:bold">do</span> |<span style="color:#606">value</span>:|
    value.include?(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Lisa</span><span style="color:#710">&quot;</span></span>)
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#777"># Pending mappings</span>
  map(<span style="color:#A60">:name</span>).pending(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">I'll do this later</span><span style="color:#710">&quot;</span></span>)

  <span style="color:#777"># Define rules for a finite set of values</span>
  map(<span style="color:#A60">:name</span>).enum <span style="color:#080;font-weight:bold">do</span>
    from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">John</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">to</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Joe</span><span style="color:#710">&quot;</span></span>
    value <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Lisa</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Jane</span><span style="color:#710">&quot;</span></span>
    otherwise <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Unknown</span><span style="color:#710">&quot;</span></span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#777"># Get is defined by the Remap::Extensions::Hash refinement</span>
  <span style="color:#777"># and allows for a path to be passed. If the path is missing,</span>
  <span style="color:#777"># the rule will be ignored in the case of `map?` and `map`</span>
  <span style="color:#777"># a detailed error message will be thrown with a detailed path</span>
  map(<span style="color:#A60">:name</span>).then <span style="color:#080;font-weight:bold">do</span> |<span style="color:#606">value</span>:|
    value.get(<span style="color:#A60">:a</span>, <span style="color:#A60">:b</span>)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>   <span style="color:#080;font-weight:bold">end</span> <span style="color:#080;font-weight:bold">end</span> <span style="background-color:hsla(120,100%,50%,0.06)"><span style="color:#161">`</span><span style="color:#161">`</span></span><span style="background-color:hsla(120,100%,50%,0.06)"><span style="color:#161">`</span><span style="color:#2B2">
</span></span></code></pre>

<p>The callback context has access to the following values</p>

<ul>
  <li><code>value</code> current value</li>
  <li><code>element</code> - defined by <code>each</code></li>
  <li><code>index</code> defined by <code>each</code></li>
  <li><code>key</code> defined by <code>to</code>, <code>map</code> and <code>each</code> on hashes</li>
  <li><code>values</code> &amp; <code>input</code> yields the mapper input</li>
  <li><code>mapper</code> the current mapper</li>
</ul>

<p>``` ruby
class Person &lt; Remap::Base
  using Remap::Extensions::Enumerable</p>

<p>define do
    get :person do
      get(:name)
      get?(:age).if do |values:|
        values.get(:person, :name) == “John”
      end
    end
  end
end
```</p>

<blockquote>
  <p>See <code>Remap::State::Extension#execute</code> for more details</p>
</blockquote>

<h3 id="fixed--semi-fixed-values">Fixed &amp; semi-fixed values</h3>

<p>A mapper can require options using the <code>option</code> method.
An option can be referenced from within callbacks and via <code>set</code>.</p>

<p>``` ruby
class Mapper &lt; Remap::Base
  option :code</p>

<p>define do
    set :secret, to: option(:code)</p>

<pre class="code ruby"><code class="ruby"><span style="color:#777"># Access {code} inside a callback</span>
map(<span style="color:#A60">:pin_code</span>, <span style="color:#606">to</span>: <span style="color:#A60">:seed</span>).then <span style="color:#080;font-weight:bold">do</span> |pin, <span style="color:#606">code</span>:|
  code**pin
<span style="color:#080;font-weight:bold">end</span>   <span style="color:#080;font-weight:bold">end</span> <span style="color:#080;font-weight:bold">end</span> <span style="background-color:hsla(120,100%,50%,0.06)"><span style="color:#161">`</span><span style="color:#161">`</span></span><span style="background-color:hsla(120,100%,50%,0.06)"><span style="color:#161">`</span><span style="color:#2B2">
</span></span></code></pre>

<p>The second argument to <code>Mapper.call</code> takes a hash and is used as options for the mapper.</p>

<p><code>ruby
Mapper.call({
  pin_code: 1234
}, code: 5678) # =&gt; { secret: 5678, seed: 3.2*10^10 }
</code></p>

<p><code>set</code> can also take a fixed value using the <code>value</code> method</p>

<p>``` ruby
class Mapper &lt; Remap::Base
  define do
    set :api_key, to: value(“ABC-123”)
  end
end</p>

<p>Mapper.call(input) # =&gt; { api_key: “ABC-123” }
```</p>

<h3 id="type-casting">Type casting</h3>

<p><code>wrap</code> allows output values to be type casts into an array.</p>

<p>``` ruby
class Mapper &lt; Remap::Base
  define do
    to :names do
      wrap(:array) do
        map :name
      end
    end
  end
end</p>

<p>Mapper.call({ name: “John” }) # ={ names: [“John”] }
```</p>

<h3 id="operators">Operators</h3>

<p>Mappers can be composed using the <code>|</code> (or), <code>&amp;</code> (and) and <code>^</code> (xor) operators.
Composed mappers can then be embedded into other mappers using <code>embed</code>.</p>

<p>``` ruby
class Bicycle &lt; Remap::Base
  contract do
    required(:gears)
    required(:brand)
  end</p>

<p>define do
    to :bicycle
  end
end</p>

<p>class Car &lt; Remap::Base
  contract do
    required(:hybrid)
    required(:fuel)
  end</p>

<p>define do
    to :car
  end
end</p>

<p>class Vehicle &lt; Remap::Base
  define do
    each do
      embed Bicycle | Car
    end
  end
end</p>

<p>Vehicle.call([
  {
    gears: 3,
    brand: “Rose”
  }, {
    hybrid: false,
    fuel: “Petrol”
  }
]) # =&gt; [{ bicycle: { gears: 3, brand: “Rose” } }, { car: { hybrid: false, fuel: “Petrol” } }]
```</p>

<h3 id="error-handling">Error handling</h3>

<p>TODO</p>

<h3 id="constructors">Constructors</h3>

<p>TODO</p>

<h3 id="schemas--rules">Schemas &amp; rules</h3>

<p>TODO</p>
</div></div>

      <div id="footer">
  Generated on Thu Dec 15 12:43:41 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.0.3).
</div>

    </div>
  </body>
</html>